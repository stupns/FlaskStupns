#Arch folder structure

FlaskStupns ↓  ## repos
- requirements.txt
- .gitignore
- blog ↓
- - config.py
- - main.py
- - .flaskenv
- - app ↓
- - - __init__.py
- - - routes.py
- - - models.py





1. pip install flask, python-dotenv
1.1 add libs to requirements
1.2 update .gitignore
2. main.py :

from app import app

2.1 config.py :

BASEDIR = os.path.abspath(os.path.dirname(__file__))

2.2 app.__init__.py :

from flask import Flask
from app.routes import main_rout

app = Flask(__name__)
app.register_blueprint(main_rout)

2.3 app.routes.py :

from flask import Blueprint
main_rout = Blueprint('main_rout', __name__)


@main_rout.route('/')
@main_rout.route('/index')
def index():
    return "Hello, World!"

2.4 .slaskenv :

FLASK_APP=main.py

# TEMPLATES

1. Create branch templates:

git checkout -b templates

2. Create template folders and html files:
app.static
app.templates
- base.html
- index.html

3. Add block to base and fill index data
4. routes.py :

main_rout = Blueprint('main_rout', __name__,
                      template_folder='templates',
                      static_folder='static')

def index():
    user = {'username': 'Serhii'}
    posts = [
        {
            'author': {'username': 'Serhii'},
            'body': 'Beautiful day in Ukraine!'
        },
        {
            'author': {'username': 'Susan'},
            'body': 'The Avengers movie was so cool!'
        }
    ]
    return render_template('index.html', title='Home', user=user, posts=posts)

5.1 GIT:

git add *
git commit
git push origin templates

git checkout master
git merge templates
git push origin master

# Web forms:

pip install flask-wtf

6. DB
pip install flask-sqlalchemy
pip install flask-migrate

6.1 Flask-SQLAlchemy Configuration

config.py :
class Config(object):
    # ...
    SQLALCHEMY_DATABASE_URI = os.environ.get('DATABASE_URL') or \
        'sqlite:///' + os.path.join(basedir, 'app.db')
    SQLALCHEMY_TRACK_MODIFICATIONS = False

6.1.2 Update __init__.py:

...
db = SQLAlchemy(app)
migrate = Migrate(app, db)

from . import models

6.1.3  Create new models.
app/models.py :

from app import db

class User(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(64), index=True, unique=True)
    email = db.Column(db.String(120), index=True, unique=True)
    password_hash = db.Column(db.String(128))

    def __repr__(self):
        return '<User {}>'.format(self.username)

6.2 Creating The Migration Repository

flask db init
flask db migrate -m "users table"

6.3 The flask db migrate command does not make any changes to the database, it just generates the migration script.
To apply the changes to the database, the flask db upgrade command must be used.

flask db upgrade
(flask db downgrade) - canceled last migration

6.3 Add new Class to models and update User:

app/models.py :

class User(db.Model):
...
    posts = db.relationship('Post', backref='author', lazy='dynamic')

class Post(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    body = db.Column(db.String(140))
    timestamp = db.Column(db.DateTime, index=True, default=datetime.utcnow)
    user_id = db.Column(db.Integer, db.ForeignKey('user.id'))

    def __repr__(self):
        return '<Post {}>'.format(self.body)

 6.3.1 Migrations

  flask db migrate -m "posts table"
  flask db upgrade

6.4 Playing with the Database
Open Console Python

>>> from app import db
>>> from app.models import User, Post
>>> u = User(username='john', email='john@example.com')
>>> db.session.add(u)
>>> db.session.commit()
>>> User.query.all()
